

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>3.5. Installing SIMP on Puppet Enterprise &mdash; SIMP 5.1.X-X documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/css_overrides.css" type="text/css" />
  

  
    <link rel="top" title="SIMP 5.1.X-X documentation" href="../index.html"/>
        <link rel="up" title="3. SIMP Getting Started Guide" href="index.html"/>
        <link rel="next" title="3.6. Building a SIMP ISO" href="Building_A_SIMP_ISO.html"/>
        <link rel="prev" title="3.4. Installing SIMP using r10k or Code Manager" href="Installing_SIMP_using_r10k.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html">
        

        
          
          <img src="../_static/SIMP_Logo.png" class="logo" />
        
        </a>

        
          
          
            <div class="version">
              5.1.X
            </div>
          
        

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to the SIMP documentation!</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Just_Install.html">1. For the Impatient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dynamic/Changelog.html">2. Changelog</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">3. Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Introduction.html">3.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dynamic/Known_OS_Compatibility.html">3.2. Known OS Compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="Installing_SIMP_From_A_Repository.html">3.3. Installing SIMP From A Repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="Installing_SIMP_using_r10k.html">3.4. Installing SIMP using r10k or Code Manager</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">3.5. Installing SIMP on Puppet Enterprise</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">3.5.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#system-requirements">3.5.2. System Requirements</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#puppet-enterprise">3.5.2.1. Puppet Enterprise</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enable-epel">3.5.2.2. Enable EPEL</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-the-simp-project-dependencies-repository">3.5.2.3. Install The SIMP-project_dependencies Repository</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#disclaimer">3.5.3. Disclaimer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-or-updating-your-control-repo">3.5.4. Creating or updating your Control Repo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#adding-simp-modules-to-the-puppetfile">3.5.4.1. Adding SIMP Modules to the Puppetfile</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-the-alternate-module-path-to-environment-conf">3.5.4.2. Adding the Alternate Module Path to environment.conf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-alternate-module-path">3.5.4.3. Creating Alternate Module Path</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-hiera">3.5.5. Configuring Hiera</a></li>
<li class="toctree-l3"><a class="reference internal" href="#node-classification">3.5.6. Node Classification</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preparing-rsync-certs">3.5.7. Preparing rsync certs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Building_A_SIMP_ISO.html">3.6. Building a SIMP ISO</a></li>
<li class="toctree-l2"><a class="reference internal" href="ISO_Install/index.html">3.7. SIMP Server ISO Installation Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="Initial_Configuration.html">3.8. Initial Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/index.html">4. User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributors_guide/index.html">5. Contributing to SIMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_conop/index.html">6. Security Concept of Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security_mapping/index.html">7. Security Control Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/index.html">8. Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">9. License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html#contact">10. Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">11. Glossary of Terms</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">SIMP</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">3. SIMP Getting Started Guide</a> &raquo;</li>
      
    <li>3.5. Installing SIMP on Puppet Enterprise</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/getting_started_guide/Installing_SIMP_on_Puppet_Enterprise.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installing-simp-on-puppet-enterprise">
<span id="install-simp-on-pe"></span><h1>3.5. Installing SIMP on Puppet Enterprise<a class="headerlink" href="#installing-simp-on-puppet-enterprise" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<p class="topic-title first">Contents:</p>
<ul class="simple">
<li><a class="reference internal" href="#overview" id="id1">Overview</a></li>
<li><a class="reference internal" href="#system-requirements" id="id2">System Requirements</a><ul>
<li><a class="reference internal" href="#puppet-enterprise" id="id3">Puppet Enterprise</a></li>
<li><a class="reference internal" href="#enable-epel" id="id4">Enable EPEL</a></li>
<li><a class="reference internal" href="#install-the-simp-project-dependencies-repository" id="id5">Install The SIMP-project_dependencies Repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#disclaimer" id="id6">Disclaimer</a></li>
<li><a class="reference internal" href="#creating-or-updating-your-control-repo" id="id7">Creating or updating your Control Repo</a><ul>
<li><a class="reference internal" href="#adding-simp-modules-to-the-puppetfile" id="id8">Adding SIMP Modules to the Puppetfile</a></li>
<li><a class="reference internal" href="#adding-the-alternate-module-path-to-environment-conf" id="id9">Adding the Alternate Module Path to environment.conf</a></li>
<li><a class="reference internal" href="#creating-alternate-module-path" id="id10">Creating Alternate Module Path</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-hiera" id="id11">Configuring Hiera</a></li>
<li><a class="reference internal" href="#node-classification" id="id12">Node Classification</a></li>
<li><a class="reference internal" href="#preparing-rsync-certs" id="id13">Preparing rsync certs</a></li>
</ul>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id1">3.5.1. Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>As of 6.0, SIMP can now be installed on top of an existing
Puppet Enterprise installation. Once installed SIMP will
configure itself to add the necessary firewall rules, and service
level exclusions based only on changes made to the PE Console.</p>
<p>Installing SIMP on top of Puppet Enterprise is a multi-step process,
involving changes at the following places in your environment:</p>
<ul class="simple">
<li>manual shell commands on the Master of Masters (MoM).</li>
<li>control repo</li>
<li>global or environment layer hiera</li>
<li>console classifier</li>
</ul>
<p>It is highly recommended to perform these steps in sequence
to prevent loss of connectivity.</p>
<p>At this time multiple compile masters and PE HA is not supported
out of the box in SIMP. We are currently working on a Technology
Preview in succeeding 6.x versions to support HA configurations
out of the box. At this time HA support requires manual configuration
and only supports manual failover.</p>
</div>
<div class="section" id="system-requirements">
<h2><a class="toc-backref" href="#id2">3.5.2. System Requirements</a><a class="headerlink" href="#system-requirements" title="Permalink to this headline">¶</a></h2>
<div class="section" id="puppet-enterprise">
<h3><a class="toc-backref" href="#id3">3.5.2.1. Puppet Enterprise</a><a class="headerlink" href="#puppet-enterprise" title="Permalink to this headline">¶</a></h3>
<p>The following versions of Puppet Enterprise are currently supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="20%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">PE Version</th>
<th class="head">SIMP Version</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>2016.4</td>
<td>6.0</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>2016.5</td>
<td>6.0</td>
<td>SIMP on PE HA requires manual configuration</td>
</tr>
<tr class="row-even"><td>2017.1</td>
<td>6.0</td>
<td>SIMP on PE HA requires manual configuration</td>
</tr>
</tbody>
</table>
<p>recommended to configure the replica master before installing SIMP. The replica provision process makes a lot of single time changes to the system to configure the replication, and SIMP’s security restrictions may prevent it from working properly.</p>
</div>
<div class="section" id="enable-epel">
<h3><a class="toc-backref" href="#id4">3.5.2.2. Enable EPEL</a><a class="headerlink" href="#enable-epel" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo yum install epel-release -y
$ sudo yum install pygpgme yum-utils git
</pre></div>
</div>
</div>
<div class="section" id="install-the-simp-project-dependencies-repository">
<h3><a class="toc-backref" href="#id5">3.5.2.3. Install The SIMP-project_dependencies Repository</a><a class="headerlink" href="#install-the-simp-project-dependencies-repository" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The repository may contain items from external vendors, most notably Puppet,
Inc. and EPEL but may also contain non-SIMP project files that have been
compiled for distribution.</p>
</div>
<p>Add the following to <code class="docutils literal"><span class="pre">/etc/yum.repos.d/simp-project_dependencies.repo</span></code>,
replacing <code class="docutils literal"><span class="pre">6</span></code> with the appropriate version of SIMP. If the repo file
does not exist, create it. The repo file for <code class="docutils literal"><span class="pre">SIMP</span> <span class="pre">6.X</span></code> is shown below.</p>
<p>If you don&#8217;t know what versions map together, please see the
<a class="reference internal" href="../help/FAQ/SIMP_Version_Guide.html#faq-simp-version-guide"><span class="std std-ref">SIMP Version Guide</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>whitespace</strong> and <strong>alignment</strong> shown before the additional <code class="docutils literal"><span class="pre">gpgkey</span></code>
values <strong>must be preserved</strong></p>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="o">[</span>simp-project_6_X_dependencies<span class="o">]</span>
<span class="nv">name</span><span class="o">=</span>simp-project_6_X_dependencies
<span class="nv">baseurl</span><span class="o">=</span>https://packagecloud.io/simp-project/6_X_Dependencies/el/<span class="nv">$releasever</span>/<span class="nv">$basearch</span>
<span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
<span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
<span class="nv">gpgkey</span><span class="o">=</span>https://raw.githubusercontent.com/NationalSecurityAgency/SIMP/master/GPGKEYS/RPM-GPG-KEY-SIMP
       https://yum.puppetlabs.com/RPM-GPG-KEY-puppetlabs
       https://yum.puppetlabs.com/RPM-GPG-KEY-puppet
       https://apt.postgresql.org/pub/repos/yum/RPM-GPG-KEY-PGDG-94
       https://getfedora.org/static/352C64E5.txt
<span class="nv">sslverify</span><span class="o">=</span><span class="m">1</span>
<span class="nv">sslcacert</span><span class="o">=</span>/etc/pki/tls/certs/ca-bundle.crt
<span class="nv">metadata_expire</span><span class="o">=</span><span class="m">300</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="disclaimer">
<h2><a class="toc-backref" href="#id6">3.5.3. Disclaimer</a><a class="headerlink" href="#disclaimer" title="Permalink to this headline">¶</a></h2>
<p>SIMP will attempt to make minor compliance changes to Puppet
Enterprise on certain versions. However we have not made major changes
to bring it in-line with FIPS 140-2 to ensure that SIMP users who have
a valid support license do not invalidate their support by using SIMP.</p>
<p>XXX TODO Insert further information relevant to the disclaimer</p>
</div>
<div class="section" id="creating-or-updating-your-control-repo">
<h2><a class="toc-backref" href="#id7">3.5.4. Creating or updating your Control Repo</a><a class="headerlink" href="#creating-or-updating-your-control-repo" title="Permalink to this headline">¶</a></h2>
<p>A Control Repo contains the modules, hieradata, and roles/profiles required for
an infrastructure, and keeping it all in a git repo creates a workflow for
updating and developing on your Puppet infrastructure.</p>
<p>Change into the directory you&#8217;re using from above and run <code class="docutils literal"><span class="pre">git</span> <span class="pre">init</span></code> to create
a control repo. Puppet, Inc has some great <a href="#id14"><span class="problematic" id="id15">`documentation of a control repo online`_</span></a>.</p>
<p>In order to use <a class="reference internal" href="../glossary.html#term-r10k"><span class="xref std std-term">r10k</span></a> or <a class="reference internal" href="../glossary.html#term-code-manager"><span class="xref std std-term">Code Manager</span></a> with SIMP, you must create
or update your <a class="reference internal" href="../glossary.html#term-control-repo"><span class="xref std std-term">Control repo</span></a> with the following components:</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">File/Directory</th>
<th class="head">Description of changes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Puppetfile</td>
<td>Add SIMP Puppet Modules</td>
</tr>
<tr class="row-odd"><td>environment.conf</td>
<td>Configures the alternate module path for rsync and pki</td>
</tr>
<tr class="row-even"><td>hieradata/</td>
<td>Directory that needs to contain SIMP top-scope hiera data</td>
</tr>
<tr class="row-odd"><td>hiera.yaml</td>
<td>Configured with simp::scenario settings and compliance map</td>
</tr>
</tbody>
</table>
<div class="section" id="adding-simp-modules-to-the-puppetfile">
<h3><a class="toc-backref" href="#id8">3.5.4.1. Adding SIMP Modules to the Puppetfile</a><a class="headerlink" href="#adding-simp-modules-to-the-puppetfile" title="Permalink to this headline">¶</a></h3>
<p>We keep an up-to-date Puppetfile in the core of our repo, which you can
download using this snippet:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ curl -o Puppetfile https://raw.githubusercontent.com/simp/simp-core/6.0.0-0/Puppetfile.stable
</pre></div>
</div>
<p>The example Puppetfile is labeled <em>stable</em>, meaning that the versions of the
modules it contains are the ones contained in the last SIMP release. You can go
to any previous release and download a Puppetfile with references to older
modules from the git history of the <code class="docutils literal"><span class="pre">simp-core</span></code> repo.</p>
<p>Our Puppetfile pulls down every dependency SIMP needs, which is currently
contains more than just modules. Open up the <code class="docutils literal"><span class="pre">Puppetfile</span></code> that was just
downloaded and remove the lines from <code class="docutils literal"><span class="pre">moduledir</span> <span class="pre">'src'</span></code> to
<code class="docutils literal"><span class="pre">moduledir</span> <span class="pre">'src/puppet/modules'</span></code>. That should just leave the Puppet modules.</p>
</div>
<div class="section" id="adding-the-alternate-module-path-to-environment-conf">
<h3><a class="toc-backref" href="#id9">3.5.4.2. Adding the Alternate Module Path to environment.conf</a><a class="headerlink" href="#adding-the-alternate-module-path-to-environment-conf" title="Permalink to this headline">¶</a></h3>
<p>SIMP uses an alternative module path, located at <code class="docutils literal"><span class="pre">/var/simp/environments/&lt;environment&gt;</span></code>
and set in each environment&#8217;s <code class="docutils literal"><span class="pre">environment.conf</span></code>.</p>
<p>Change or add a modulepath directive like so:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span>modulepath=modules:/var/simp/environments/&lt;environment&gt;/site_files:$basemodulepath
</pre></div>
</div>
</div>
<div class="section" id="creating-alternate-module-path">
<h3><a class="toc-backref" href="#id10">3.5.4.3. Creating Alternate Module Path</a><a class="headerlink" href="#creating-alternate-module-path" title="Permalink to this headline">¶</a></h3>
<p>Currently, it contains the rsync assets and PKI data, custom to each host. Here
is an example from a fresh install:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ tree -L <span class="m">1</span> /var/simp/environments/production
/var/simp/environments/production
├── rsync
└── site_files
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">rsync</span></code> is a tree that stores data that will be copied over to modules. We
have chosen rsync for these applications because of how it handles large files
and large amounts of files. See <a class="reference internal" href="../help/FAQ/Rsync.html#rsync-justification"><span class="std std-ref">Why does SIMP use rsync?</span></a>.</li>
<li><code class="docutils literal"><span class="pre">site_files</span></code> is a place to store private files that may not belong in the
control repo or another data source. And example of this would be host-based
x509 certificates (which are used heavily by SIMP).</li>
</ul>
<dl class="docutils">
<dt>Create a puppet group to own the directories:</dt>
<dd>groupadd puppet</dd>
</dl>
<p>Each of these directories need to be created manually, except rsync, which
requires a bit more work:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">environment</span><span class="o">=</span>production
mkdir -p /var/simp/environments/<span class="si">${</span><span class="nv">environment</span><span class="si">}</span>/<span class="o">{</span>site_files/modules/pki_files,files/keydist<span class="o">}</span>
chown root.puppet /var/simp/environments/<span class="si">${</span><span class="nv">environment</span><span class="si">}</span>/site_files
chmod -R g+rX /var/simp/environments/<span class="si">${</span><span class="nv">environment</span><span class="si">}</span>/site_files
</pre></div>
</div>
<p>The rsync folder has a few tricks. When installed from an ISO, this data and
folder structure is laid out by the <code class="docutils literal"><span class="pre">simp-rsync</span></code> rpm. When installing using the
method described in this document, the git repo will have to be cloned and
manipulated:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone https://github.com/simp/simp-rsync.git /tmp/simp-rsync
mv -f /tmp/simp-rsync/environments/simp/rsync /var/simp/environments/<span class="si">${</span><span class="nv">environment</span><span class="si">}</span>/
ln -s /var/simp/environments/<span class="si">${</span><span class="nv">environment</span><span class="si">}</span>/rsync/RedHat /var/simp/environments/<span class="si">${</span><span class="nv">environment</span><span class="si">}</span>/rsync/CentOS
chmod u+rwx,g+rX,o+rX /var/simp/<span class="o">{</span>environments,environments/<span class="si">${</span><span class="nv">environment</span><span class="si">}</span><span class="o">}</span>
</pre></div>
</div>
<p>Rsync&#8217;s primary use case in a base SIMP infrastructure is to distribute ClamAV
databases. If <code class="docutils literal"><span class="pre">simp_options::clamav</span></code> is set to true, rsync and this step are
required.</p>
<p>Install <code class="docutils literal"><span class="pre">clamav-update</span></code> and download the latest database using the following
config and commands, replacing &lt;environment&gt; with your environment.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ cat <span class="s">&lt;&lt; EOF &gt; /tmp/freshclam.conf</span>
<span class="s">DatabaseDirectory /var/simp/environments/${environment}/rsync/Global/clamav</span>
<span class="s">DatabaseMirror database.clamav.net</span>
<span class="s">Bytecode yes</span>
<span class="s">EOF</span>
</pre></div>
</div>
<div class="highlight-bash"><div class="highlight"><pre><span></span>yum install -y clamav-update
freshclam -u root --config-file<span class="o">=</span>/tmp/freshclam.conf
</pre></div>
</div>
<p>Be careful when copying the first rsync environment around. There are hidden
files in each folder that represents and rsync share called <code class="docutils literal"><span class="pre">.shares</span></code>. There
is a fact in the <code class="docutils literal"><span class="pre">simp</span></code> modules that checks for that files. The fact is then
ingested by <code class="docutils literal"><span class="pre">simp::server::rsync_shares</span></code> and rsync shares are created on the
Puppet server.
.. _simp-core Git repository: <a class="reference external" href="https://github.com/simp/simp-core/tree/master/build/distributions/CentOS/7/x86_64/DVD/ks">https://github.com/simp/simp-core/tree/master/build/distributions/CentOS/7/x86_64/DVD/ks</a>
.. _simp-core: <a class="reference external" href="https://github.com/simp/simp-core/">https://github.com/simp/simp-core/</a>
.. _documentation of a control repo online: <a class="reference external" href="https://docs.puppet.com/pe/latest/cmgmt_control_repo.html">https://docs.puppet.com/pe/latest/cmgmt_control_repo.html</a></p>
</div>
</div>
<div class="section" id="configuring-hiera">
<h2><a class="toc-backref" href="#id11">3.5.5. Configuring Hiera</a><a class="headerlink" href="#configuring-hiera" title="Permalink to this headline">¶</a></h2>
<p>In order to configure a working SIMP environment in a control-repo, you will need to add some settings to hiera. If you do not have a hiera.yaml in the root of your control-repo, you can use Puppet’s environment layer feature and just create a hiera.yaml file with the following contents:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="l l-Scalar l-Scalar-Plain">datadir</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hieradata</span>
<span class="l l-Scalar l-Scalar-Plain">hierarchy</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&#39;Common&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;common&#39;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;Compliance&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;compliance_profiles/%{::compliance_profile}&#39;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;Scenario&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yaml</span>
    <span class="l l-Scalar l-Scalar-Plain">path</span><span class="p p-Indicator">:</span> <span class="s">&#39;scenarios/%{::simp_scenario}&#39;</span>
</pre></div>
</div>
<p>If running a version of SIMP 6 prior to 6.0.1, you will need to tweak your common.yaml to work around a bug in 6.0.0 and the Release candidate:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">pupmod::pe_classlist</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">puppet_enterprise::profile::database</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pe-postgres</span>
    <span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pe-postgresql</span>
    <span class="l l-Scalar l-Scalar-Plain">firewall_rules</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5432</span>
  <span class="l l-Scalar l-Scalar-Plain">puppet_enterprise::profile::puppetdb</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pe-puppetdb</span>
    <span class="l l-Scalar l-Scalar-Plain">services</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">pe-puppetdb</span>
    <span class="l l-Scalar l-Scalar-Plain">firewall_rules</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tcp</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">8081</span>
</pre></div>
</div>
</div>
<div class="section" id="node-classification">
<h2><a class="toc-backref" href="#id12">3.5.6. Node Classification</a><a class="headerlink" href="#node-classification" title="Permalink to this headline">¶</a></h2>
<p>Create a node group called &#8216;SIMP Servers&#8217;, and assign the Master of Masters to the group.</p>
<p>This server needs to have two classes assigned:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>simp
simp::server::rsync_shares
</pre></div>
</div>
<p>You will also need to specify your simp::scenario. &#8216;poss&#8217; will only manage pupmod and will generally work with PE without any extra configuration. However it will not bring the server up to any compliance standard. &#8216;simp-lite&#8217; and &#8216;simp&#8217; scenarios will reconfigure the server with various compliance settings.</p>
<img alt="../_images/pe_classes.png" src="../_images/pe_classes.png" />
</div>
<div class="section" id="preparing-rsync-certs">
<h2><a class="toc-backref" href="#id13">3.5.7. Preparing rsync certs</a><a class="headerlink" href="#preparing-rsync-certs" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nv">hostname</span><span class="o">=</span><span class="k">$(</span>hostname<span class="k">)</span>
mkdir -p /etc/pki/simp_apps/stunnel/x509/<span class="o">{</span>public,private,cacerts<span class="o">}</span>
cp /etc/puppetlabs/puppet/ssl/certs/<span class="si">${</span><span class="nv">hostname</span><span class="si">}</span>.pem /etc/pki/simp_apps/stunnel/x509/public/<span class="si">${</span><span class="nv">hostname</span><span class="si">}</span>.pub
cp /etc/puppetlabs/puppet/ssl/ca/ca_crt.pem /etc/pki/simp_apps/stunnel/x509/cacerts/cacerts.pem
cp /etc/puppetlabs/puppet/ssl/private_keys/<span class="si">${</span><span class="nv">hostname</span><span class="si">}</span>.pem /etc/pki/simp_apps/stunnel/x509/private/
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Building_A_SIMP_ISO.html" class="btn btn-neutral float-right" title="3.6. Building a SIMP ISO" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Installing_SIMP_using_r10k.html" class="btn btn-neutral" title="3.4. Installing SIMP using r10k or Code Manager" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, THE SIMP TEAM.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'4.2.X',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>